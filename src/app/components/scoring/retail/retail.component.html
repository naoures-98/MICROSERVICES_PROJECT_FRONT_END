<div class="container mt-3">
    <h4>Gestion des  Clients Particuliers</h4>
    <div class="container container-small mt-3">
        <button type="button" class="btn btn-custom-secondary btn-small  me-2 mb-3" data-bs-toggle="modal" data-bs-target="#retailModal">
            Ajouter un nouveau Client Particulier
        </button>
        <button type="button" class="btn btn-custom-secondary btn-small me-2 mb-3" data-bs-toggle="modal" data-bs-target="#retailImportExcelModal">
            Import EXCEL
        </button>
        <input type="text" [(ngModel)]="searchText" class="form-control small-input mb-3" placeholder="Rechercher...">
    </div>
    <table class="table table-bordered table-small">
        <thead>
            <tr>
                <th>#</th>
                <th>IDENTIFIANT</th>
                <th>REFERENCE DEMANDE</th>
                <th>CIVILITE</th>
                <th>NOM</th>
                <th>PRENOM</th>
                
                
                <th class="text-center">ACTIONS</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let retail  of filteredRetails | paginate: { itemsPerPage: itemsPerPage, currentPage: p }">
                <td>{{ retail.id }}</td>
                <td>{{ retail.clientRequest }}</td>
                <td>{{ retail.contractReference }}</td>
                <td>{{ retail.civility }}</td>
                <td>{{ retail.lastName }}</td>
                <td>{{ retail.firstName }}</td>
                
                <td class="text-center">
                    <button type="button" class="btn btn-outline-dark btn-small me-2" data-bs-toggle="modal" (click)="showDetails(retail)" data-bs-target="#retailDetailsModal">
                        Details
                    </button>
                    <button type="button" class="btn btn-custom-warning btn-small me-2" data-bs-toggle="modal" (click)="editRetail(retail)" data-bs-target="#retailEditModal">
                        Modifier
                    </button>
                    <button class="btn btn-custom-danger btn-small" (click)="openDeleteModal(retail.id)" data-bs-toggle="modal" data-bs-target="#confirmDeleteModal">
                        Supprimer</button>
                </td>
            </tr>
        </tbody>
    </table>
    <pagination-controls (pageChange)="p = $event"></pagination-controls>
</div>
<!-- Modal pour detailler les données client   -->
<div class="modal fade" id="retailDetailsModal" tabindex="-1" aria-labelledby="retailDetailsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h6 class="modal-title" id="retailDetailsModalLabel">Détails client</h6>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="retailDetailsForm" #retailDetailsForm="ngForm">
                    <div class="border p-3 rounded mb-4"> 
                        <h6 class="custom-label mb-3">Données Agence</h6>
                        <hr class="mb-3">
                        <div class="form-row mb-3 d-flex align-items-end">
                            <div class="form-group me-3">
                                <label for="retailCodeAgence" class="form-label small-label">Code Agence</label>
                                <input type="text" class="form-control small-input" [disabled]="true" required 
                                    [(ngModel)]="retail.branch.branchCode" 
                                    [value]="retail.branch.id"
                                    name="branchCode" id="retailCodeAgence">
                            </div>
                            <div class="form-group me-3">
                                <label for="retailNomAgence" class="form-label small-label">Nom Agence</label>
                                <input type="text" class="form-control small-input" [disabled]="true" required 
                                    [(ngModel)]="retail.branch.description" 
                                    name="branchName" id="retailNomAgence">
                            </div>
                        </div> <!-- Ligne séparatrice avec marge en bas -->
                    </div>
                    
                    <div class="border p-3 rounded mb-4"> 
                        <h6 class="custom-label mb-3">Données Demande</h6>
                        <hr class="mb-3">
                        <div class="form-row mb-3 d-flex align-items-end">
                            <div class="form-group me-3">
                                <label for="retailAnnee" class="form-label small-label">Année</label>
                                <input type="text" class="form-control small-input" [disabled]="true" required #retailAnnee="ngModel" [(ngModel)]="retail.year" name="year" id="year">
                            </div>
                        </div> <!-- Ligne séparatrice avec marge en bas -->
                        <div class="form-row mb-3 d-flex align-items-end">
                            <div class="form-group me-3">
                                <label for="retailClientIdentifier" class="form-label small-label">Identifiant Client</label>
                                <input type="text" class="form-control small-input" [disabled]="true" required #retailClientIdentifier="ngModel" [(ngModel)]="retail.clientRequest" name="clientRequest" id="clientRequest">
                            </div>
                            <div class="form-group me-3">
                                <label for="retailRequestRef" class="form-label small-label">Référence demande</label>
                                <input type="text" class="form-control small-input" [disabled]="true" required #retailRequestRef="ngModel" [(ngModel)]="retail.contractReference" name="contractReference" id="contractReference">
                            </div>
                        </div>

                    </div>
                    <div class="border p-3 rounded mb-4"> 
                        <h4 class="custom-label mb-3">Données client</h4>
                        <hr class="mb-3"> <!-- Ligne séparatrice avec marge en bas -->
                        <div class="form-row mb-3 d-flex align-items-end">
                            <div class="form-group me-3">
                                <label for="retailCivilite" class="form-label small-label">Civilité</label>
                                <input type="text" class="form-control small-input" [disabled]="true" required #retailCivilite="ngModel" [(ngModel)]="retail.civility" name="civility" id="civility">
                            </div>
                            <div class="form-group me-3">
                                <label for="retailSexe" class="form-label small-label">Sexe</label>
                                <input type="text" class="form-control small-input" [disabled]="true" required #retailSexe="ngModel" [(ngModel)]="retail.gender" name="gender" id="gender">
                            </div>
                            <div class="form-group me-3">
                                <label for="retailFamilySituation" class="form-label small-label">Situation de Famille</label>
                                <input type="text" class="form-control small-input" [disabled]="true" required #retailFamilySituation="ngModel" [(ngModel)]="retail.familySituation" name="familySituation" id="familySituation">
                            </div>
                        </div>
                        <div class="form-row mb-3 d-flex align-items-end">
                            <div class="form-group me-3">
                                <label for="retailFirstName" class="form-label small-label">Prenom</label>
                                <input type="text" class="form-control small-input" [disabled]="true" required #retailFirstName="ngModel" [(ngModel)]="retail.firstName" name="firstName" id="firstName">
                            </div>
                            <div class="form-group me-3">
                                <label for="retailLastName" class="form-label small-label">Nom</label>
                                <input type="text" class="form-control small-input" [disabled]="true" required #retailLastName="ngModel" [(ngModel)]="retail.lastName" name="lastName" id="lastName">
                            </div>

                        </div>
                        <div class="form-row mb-3 d-flex align-items-end">
                            <div class="form-group me-3">
                                <label for="retailBirthDate" class="form-label small-label">Date Naissance</label>
                                <input type="date" class="form-control small-input" [disabled]="true" required #retailBirthDate="ngModel" [(ngModel)]="retail.birthDate" name="birthDate" id="birthDate">
                            </div>
                            <div class="form-group me-3">
                                <label for="retailAge" class="form-label small-label">Age</label>
                                <input type="text" class="form-control small-input" [disabled]="true" required #retailAge="ngModel" [(ngModel)]="retail.age" name="age" id="age">
                            </div>
                        </div>
                        <div class="form-row mb-3 d-flex align-items-end">
                            <div class="form-group me-3">
                                <label for="retailEmail" class="form-label small-label">Email</label>
                                <input type="text" class="form-control small-input" [disabled]="true" required #retailEmail="ngModel" [(ngModel)]="retail.email" name="email" id="email">
                            </div>
                            <div class="form-group me-3">
                                <label for="retailTel" class="form-label small-label">Téléphone</label>
                                <input type="text" class="form-control small-input" [disabled]="true" required #retailTel="ngModel" [(ngModel)]="retail.telephone" name="telephone" id="telephone">
                            </div>
                        </div>
                                                
                    </div>
                    <div class="border p-3 rounded mb-4"> 
                        <h4 class="custom-label mb-3">Données Financement</h4>
                        <hr class="mb-3"> <!-- Ligne séparatrice avec marge en bas -->
                                                
                        <div class="form-row mb-3 d-flex align-items-end">
                            <div class="form-group me-3">
                                <label for="retailProfession" class="form-label small-label">Profession</label>
                                <input type="text" class="form-control small-input" [disabled]="true"  required #retailProfession="ngModel" [(ngModel)]="retail.profession" name="profession" id="profession">
                            </div>
                            <div class="form-group me-3">
                                <label for="retailEmploiStatus" class="form-label small-label">Statut Emplois</label>
                                <select class="form-control small-input" required [disabled]="true"  [(ngModel)]="retail.employementStatus" name="employementStatus" id="employementStatus">
                                    <option *ngFor="let option of emploiStatusOptions" [value]="option">{{ option }}</option>
                                </select>
                                <!--input type="text" class="form-control small-input"  required #retailEmploiStatus="ngModel" [(ngModel)]="retail.employementStatus" name="employementStatus" id="employementStatus"-->
                            </div>
                            
                        </div>
                        <div class="form-row mb-3 d-flex align-items-end">
                            <div class="form-group me-3">
                                <label for="retailRevenu" class="form-label small-label">Revenues Client</label>
                                <input type="text" class="form-control small-input"  [disabled]="true" required #retailRevenu="ngModel" 
                                [(ngModel)]="retail.revenu" name="revenu" id="revenu"
                                (ngModelChange)="onRevenueChange($event)">
                            </div>
                            <div class="form-group me-3">
                                <label for="retailNbrDependents" class="form-label small-label">Nombre des personnes a charge</label>
                                <input type="text" class="form-control small-input"  [disabled]="true" required #retailNbrDependents="ngModel" [(ngModel)]="retail.nbrDependents" name="nbrDependents" id="nbrDependents">
                            </div>
                        </div>
                        <div class="form-row mb-3 d-flex align-items-end">
                            
                            <div class="form-group me-3">
                                <label for="retailRelationEntryDate" class="form-label small-label">Date d'entrée en relation avec la Banque </label>
                                <input type="date" class="form-control small-input" [disabled]="true" required #retailRelationEntryDate="ngModel" 
                                [(ngModel)]="retail.relationEntryDate" name="relationEntryDate" id="relationEntryDate"
                                (ngModelChange)="onRelationEntryDateChange($event)">
                            </div>
                            <div class="form-group me-3">
                                <label for="retailSeniorityRelation" class="form-label small-label">Ancienneté relation avec la banque</label>
                                <input type="texy" class="form-control small-input" [disabled]="true" required #retailSeniorityRelation="ngModel" [(ngModel)]="retail.seniorityRelation" name="seniorityRelation" id="seniorityRelation">
                                <!--input type="text" class="form-control small-input"  required #retailEmploiStatus="ngModel" [(ngModel)]="retail.employementStatus" name="employementStatus" id="employementStatus"-->
                            </div>
                            
                        </div>
                    </div>
                    <div class="border p-3 rounded mb-4" *ngIf="retail.employementStatus =='CDD' ||retail.employementStatus =='CDI'  "> 
                        <h6 class="custom-label mb-3">Employeur / Contrepartie </h6>
                        <hr class="mb-3">
                        <div class="form-row mb-3 d-flex align-items-end">
                            <div class="form-group me-3">
                                <label for="retailEmployerSize" class="form-label small-label">Taille de l'employeur</label>
                                <select id="employerSizeSelect" #retailEmployerSize="ngModel"  [disabled]="true"
                                [(ngModel)]="retail.employerSize" name="retailEmployerSize" 
                                class="form-select small-select" required>
                                    <option [value]="'Grande Entreprise'">GE</option>
                                    <option [value]="'PME'">PME</option>
                                    <option [value]="'PME'">TPE</option>
                                </select>
                                <!--input type="text" class="form-control small-input"  required #retailFinancingType="ngModel" [(ngModel)]="retail.financingType.description" name="financingTypeId" id="financingTypeId"-->
                            </div>
                            <div class="form-group me-3">
                                <label for="retailActivitySector" class="form-label small-label">Secteur d'activité </label>
                                <select id="activitySectorSelect" #retailActivitySector="ngModel"  [disabled]="true"
                                [(ngModel)]="retail.activitySector.code" name="retailActivitySector" 
                                class="form-select small-select" required
                                (ngModelChange)="onActivitySectorChange($event)">
                                    <option *ngFor="let activite of activities" [value]="activite.code">{{ activite.description}}</option>
                                </select>                            
                            </div>
                        </div>
                        <div class="form-row mb-3 d-flex align-items-end">
                            
                            <div class="form-group me-3">
                                <label for="retailEmployementEntryDate" class="form-label small-label">Date Création</label>
                                <input type="date" class="form-control small-input"  [disabled]="true" required #retailEmployementEntryDate="ngModel" 
                                [(ngModel)]="retail.employementEntryDate" name="employementEntryDate" id="employementEntryDate"
                                (ngModelChange)="onEmployementEntryDateChange($event)">
                            </div>
                            <div class="form-group me-3">
                                <label for="retailNbYearExperience" class="form-label small-label">Ancienneté de l'employeur</label>
                                <input type="texy" class="form-control small-input" [disabled]="true" required #retailNbYearExperience="ngModel" [(ngModel)]="retail.nbYearExperience" name="nbYearExperience" id="nbYearExperience">
                                <!--input type="text" class="form-control small-input"  required #retailEmploiStatus="ngModel" [(ngModel)]="retail.employementStatus" name="employementStatus" id="employementStatus"-->
                            </div>
                            
                        </div>
                        
                        <!-- Ligne séparatrice avec marge en bas -->
                    </div>
                    <div class="border p-3 rounded mb-4"> 
                        <h6 class="custom-label mb-3">Données Engagement</h6>
                        <hr class="mb-3">
                        <div class="form-row mb-3 d-flex align-items-end">
                            <div class="form-group me-3">
                                <label for="retailFinancingType" class="form-label small-label">Type de Financement</label>
                                <input type="text" class="form-control small-input" [disabled]="true" required #retailFinancingType="ngModel" [(ngModel)]="retail.financingType.description" name="financingTypeId" id="financingTypeId">
                            </div>
                        </div>
                        <div class="form-row mb-3 d-flex align-items-end">
                            <div class="form-group me-3">
                                <label for="retailStartDate" class="form-label small-label">Date début</label>
                                <input type="date" class="form-control small-input" [disabled]="true" required #retailStartDate="ngModel" [(ngModel)]="retail.startDate" name="startDate" id="startDate">
                            </div>
                            <div class="form-group me-3">
                                <label for="retailEndDate" class="form-label small-label">Date Fin</label>
                                <input type="date" class="form-control small-input" [disabled]="true" required #retailEndDate="ngModel" [(ngModel)]="retail.endDate" name="endDate" id="endDate">
                            </div>
                        </div>
                        
                        <!-- Ligne séparatrice avec marge en bas -->
                    </div>
                    <div class="border p-3 rounded mb-4"> 
                        <h6 class="custom-label mb-3">Comportement client </h6>
                        <hr class="mb-3">
                        <div class="form-row mb-3 d-flex align-items-end">
                            <div class="form-group me-3">
                                <label for="retailEcheance" class="form-label small-label">Echeance</label>
                                <input type="text" class="form-control small-input" required #retailEcheance="ngModel" 
                                [(ngModel)]="retail.echeance" [disabled]="true" name="echeance" id="echeance"
                                (ngModelChange)="onEcheanceChange($event)">
                            </div>
                            <div class="form-group me-3">
                                <label for="retailTauxEndettement" class="form-label small-label">Taux d'endettement</label>
                                <input type="text" class="form-control small-input"  required #retailTauxEndettement="ngModel" 
                                [(ngModel)]="retail.deptRatio" [disabled]="true" name="deptRatio" id="deptRatio"
                                [disabled]="true">
                            </div>
                            
                        </div>
                        <div class="form-row mb-3 d-flex align-items-end">
                            <div class="form-group me-3">
                                <label for="retailUnpaiedPresence" class="form-label small-label">Comportement client (Banque & Secteur) Presence d'impayé </label>
                                <select id="retailUnpaiedPresence" #retailImpaye="ngModel"  
                                [(ngModel)]="retail.unpaidPresence" [disabled]="true" name="retailUnpaiedPresence" 
                                class="form-select small-select" required>
                                <option [value]="'Aucun impayé'">Aucun impayé et IMP Secteur (Non)</option>
                                <option [value]="'impayé inf 2 mois'">Impayés Inf à deux mois (< 2 Mois)</option>
                                <option [value]="'impayé sup 2 mois'">2 Mois < Impayés <= 3 Mois</option>
                                <option [value]="'impayé sup 3 mois'">Impayés Sup à 3 Mois et IMP Secteur (oui)</option>
                            </select>
                                
                                <!--input type="text" class="form-control small-input"  required #retailFinancingType="ngModel" [(ngModel)]="retail.financingType.description" name="financingTypeId" id="financingTypeId"-->
                            </div>
                            <div class="form-group me-3">
                                <label for="retailPayementIncident" class="form-label small-label">Incidents de paiement </label>
                                <select id="retailPayementIncident" #retailPayementIncident="ngModel"  
                                [(ngModel)]="retail.payementIncident" [disabled]="true" name="retailPayementIncident" 
                                class="form-select small-select" required>
                                <option [value]="'Aucun incident'">Aucun incident</option>
                                <option [value]="'incident de paiement sur cheque'">Incidents de paiement sur chéque durant les 3 derniers mois</option>
    
                                </select>
                                
                            </div>
                        </div>
                        <!-- Ligne séparatrice avec marge en bas -->
                    </div>
                    <div class="border p-3 rounded mb-4" *ngIf="retail.clientNotation!=null"> 
                        <h6 class="custom-label mb-3">Score Client</h6>
                        <hr class="mb-3">
                        <div class="form-row mb-3 d-flex align-items-end">
                            <div class="form-group me-3">
                                <label for="finalScore" class="form-label small-label">Score Final</label>
                                <input type="text" class="form-control small-input" [disabled]="true" required #finalScore="ngModel" [(ngModel)]="retail.clientNotation.finalScore" name="finalScore" id="finalScore">
                            </div>
                            <div class="form-group me-3">
                                <label for="pd" class="form-label small-label">PD</label>
                                <input type="text" class="form-control small-input" [disabled]="true" required #pd="ngModel" [(ngModel)]="retail.clientNotation.pd" name="pd" id="pd">
                            </div>
                        </div>
                        <div class="form-row mb-3 d-flex align-items-end">
                            <div class="form-group me-3">
                                <label for="retailNote" class="form-label small-label">Niveau</label>
                                <input type="text" class="form-control small-input" [disabled]="true" required #retailNote="ngModel" [(ngModel)]="retail.clientNotation.decisionOctroi" name="clientNotation" id="clientNotation">
                            </div>
                            <div class="form-group me-3">
                                <label for="classe" class="form-label small-label">Classe</label>
                                <input type="text" class="form-control small-input" [disabled]="true" required #classe="ngModel" [(ngModel)]="retail.clientNotation.classe" name="classe" id="classe">
                            </div>
                        </div> <!-- Ligne séparatrice avec marge en bas -->
                    </div>
                    
                    <!-- Uncomment to add a submit button -->
                    <!-- <button class="btn btn-success" [disabled]="!editSegmentForm.form.valid" type="submit">Submit</button> -->
                </form>
                <div class="modal-footer">
                    <button type="button" class="btn btn-custom-danger btn-small" data-bs-dismiss="modal">Annuler</button>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- Modal pour editer client   -->
<div class="modal fade" id="retailEditModal" tabindex="-1" aria-labelledby="retailEditModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h6 class="modal-title" id="retailEditModalLabel">Modifier client</h6>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="retailEditForm" (ngSubmit)="onEditSubmit()" #retailEditForm="ngForm">
                    <div class="border p-3 rounded mb-4"> 
                        <h6 class="custom-label mb-3">Données Agence</h6>
                        <hr class="mb-3">
                        <div class="form-row mb-3 d-flex align-items-end">
                            <div class="form-group me-3">
                                <label for="retailIdAgence" class="form-label small-label">Id Agence</label>
                                <input type="text" class="form-control small-input" [disabled]="true" required 
                                    [(ngModel)]="retail.branch.id" 
                                    name="retailIdAgence" id="retailIdAgence">
                            </div>
                            <div class="form-group me-3">
                                <label for="retailCodeAgence" class="form-label small-label">Code Agence</label>
                                <input type="text" class="form-control small-input" [disabled]="true" required 
                                    [(ngModel)]="retail.branch.branchCode" 
                                    name="branchCode" id="retailCodeAgence">
                            </div>
                            <div class="form-group me-3">
                                <label for="retailNomAgence" class="form-label small-label">Nom Agence</label>
                                <input type="text" class="form-control small-input" [disabled]="true" required 
                                    [(ngModel)]="retail.branch.description" 
                                    name="branchName" id="retailNomAgence">
                            </div>
                        </div> <!-- Ligne séparatrice avec marge en bas -->
                    </div>
                    
                    <div class="border p-3 rounded mb-4"> 
                        <h6 class="custom-label mb-3">Données Demande</h6>
                        <hr class="mb-3">
                        <div class="form-row mb-3 d-flex align-items-end">
                            <div class="form-group me-3">
                                <label for="retailAnnee" class="form-label small-label">Année</label>
                                <input type="text" class="form-control small-input" [disabled]="true" required #retailAnnee="ngModel" [(ngModel)]="retail.year" name="year" id="year">
                            </div>
                        </div> <!-- Ligne séparatrice avec marge en bas -->
                        <div class="form-row mb-3 d-flex align-items-end">
                            <div class="form-group me-3">
                                <label for="retailClientIdentifier" class="form-label small-label">Identifiant Client</label>
                                <input type="text" class="form-control small-input" [disabled]="true" required #retailClientIdentifier="ngModel" [(ngModel)]="retail.clientRequest" name="clientRequest" id="clientRequest">
                            </div>
                            <div class="form-group me-3">
                                <label for="retailRequestRef" class="form-label small-label">Référence demande</label>
                                <input type="text" class="form-control small-input" [disabled]="true" required #retailRequestRef="ngModel" [(ngModel)]="retail.contractReference" name="contractReference" id="contractReference">
                            </div>
                        </div>

                    </div>
                    <div class="border p-3 rounded mb-4"> 
                        <h4 class="custom-label mb-3">Données client</h4>
                        <hr class="mb-3"> <!-- Ligne séparatrice avec marge en bas -->
                        <div class="form-row mb-3 d-flex align-items-end">
                            <div class="form-group me-3">
                                <label for="retailCivilite" class="form-label small-label">Civilité</label>
                                <select class="form-control small-input" required [(ngModel)]="retail.civility" name="civility" id="civility">
                                    <option *ngFor="let option of civilityOptions" [value]="option">{{ option }}</option>
                                </select>
                                <!--input type="text" class="form-control small-input"  required #retailCivilite="ngModel" [(ngModel)]="retail.civility" name="civility" id="civility"-->
                            </div>
                            <div class="form-group me-3">
                                <label for="retailSexe" class="form-label small-label">Sexe</label>
                                <select class="form-control small-input" required [(ngModel)]="retail.gender" name="gender" id="gender">
                                    <option *ngFor="let option of genderOptions" [value]="option">{{ option }}</option>
                                </select>
                                <!--input type="text" class="form-control small-input"  required #retailSexe="ngModel" [(ngModel)]="retail.gender" name="gender" id="gender"-->
                            </div>
                            <div class="form-group me-3">
                                <label for="retailFamilySituation" class="form-label small-label">Situation de Famille</label>
                                <select class="form-control small-input" required [(ngModel)]="retail.familySituation" name="familySituation" id="familySituation">
                                    <option *ngFor="let situation  of familySituationOptions" [value]="situation ">{{ familySituationDisplay[situation] }}</option>
                                </select>
                                <!--input type="text" class="form-control small-input"  required #retailFamilySituation="ngModel" [(ngModel)]="retail.familySituation" name="familySituation" id="familySituation"-->
                            </div>
                        </div>
                        <div class="form-row mb-3 d-flex align-items-end">
                            <div class="form-group me-3">
                                <label for="retailFirstName" class="form-label small-label">Prenom</label>
                                <input type="text" class="form-control small-input" required #retailFirstName="ngModel" [(ngModel)]="retail.firstName" name="firstName" id="firstName">
                            </div>
                            <div class="form-group me-3">
                                <label for="retailLastName" class="form-label small-label">Nom</label>
                                <input type="text" class="form-control small-input" required #retailLastName="ngModel" [(ngModel)]="retail.lastName" name="lastName" id="lastName">
                            </div>

                        </div>
                        <div class="form-row mb-3 d-flex align-items-end">
                            <div class="form-group me-3">
                                <label for="retailBirthDate" class="form-label small-label">Date Naissance</label>
                                <input type="date" class="form-control small-input"  required #retailBirthDate="ngModel" 
                                [(ngModel)]="retail.birthDate" name="birthDate" id="birthDate"
                                (ngModelChange)="onBirthDateChange($event)" >
                            </div>
                            <div class="form-group me-3">
                                <label for="retailAge" class="form-label small-label">Age</label>
                                <input type="text" class="form-control small-input" [disabled]="true"  required #retailAge="ngModel" [(ngModel)]="retail.age" name="age" id="age">
                            </div>
                        </div>
                        
                        <div class="form-row mb-3 d-flex align-items-end">
                            <div class="form-group me-3">
                                <label for="retailEmail" class="form-label small-label">Email</label>
                                <input type="text" class="form-control small-input"  required #retailEmail="ngModel" [(ngModel)]="retail.email" name="email" id="email">
                            </div>
                            <div class="form-group me-3">
                                <label for="retailTel" class="form-label small-label">Téléphone</label>
                                <input type="text" class="form-control small-input" required #retailTel="ngModel" [(ngModel)]="retail.telephone" name="telephone" id="telephone">
                            </div>
                        </div>
                    </div>
                    <div class="border p-3 rounded mb-4"> 
                        <h4 class="custom-label mb-3">Données Financement</h4>
                        <hr class="mb-3"> <!-- Ligne séparatrice avec marge en bas -->
                                                
                        <div class="form-row mb-3 d-flex align-items-end">
                            <div class="form-group me-3">
                                <label for="retailProfession" class="form-label small-label">Profession</label>
                                <input type="text" class="form-control small-input"  required #retailProfession="ngModel" [(ngModel)]="retail.profession" name="profession" id="profession">
                            </div>
                            <div class="form-group me-3">
                                <label for="retailEmploiStatus" class="form-label small-label">Statut Emplois</label>
                                <select class="form-control small-input" required [(ngModel)]="retail.employementStatus" name="employementStatus" id="employementStatus">
                                    <option *ngFor="let option of emploiStatusOptions" [value]="option">{{ option }}</option>
                                </select>
                                <!--input type="text" class="form-control small-input"  required #retailEmploiStatus="ngModel" [(ngModel)]="retail.employementStatus" name="employementStatus" id="employementStatus"-->
                            </div>
                            
                        </div>
                        <div class="form-row mb-3 d-flex align-items-end">
                            <div class="form-group me-3">
                                <label for="retailRevenu" class="form-label small-label">Revenues Client</label>
                                <input type="text" class="form-control small-input"  required #retailRevenu="ngModel" 
                                [(ngModel)]="retail.revenu" name="revenu" id="revenu"
                                (ngModelChange)="onRevenueChange($event)">
                            </div>
                            <div class="form-group me-3">
                                <label for="retailNbrDependents" class="form-label small-label">Nombre des personnes a charge</label>
                                <input type="text" class="form-control small-input"  required #retailNbrDependents="ngModel" [(ngModel)]="retail.nbrDependents" name="nbrDependents" id="nbrDependents">
                            </div>
                        </div>
                        <div class="form-row mb-3 d-flex align-items-end">
                            
                            <div class="form-group me-3">
                                <label for="retailRelationEntryDate" class="form-label small-label">Date d'entrée en relation avec la Banque </label>
                                <input type="date" class="form-control small-input" required #retailRelationEntryDate="ngModel" 
                                [(ngModel)]="retail.relationEntryDate" name="relationEntryDate" id="relationEntryDate"
                                (ngModelChange)="onRelationEntryDateChange($event)">
                            </div>
                            <div class="form-group me-3">
                                <label for="retailSeniorityRelation" class="form-label small-label">Ancienneté relation avec la banque</label>
                                <input type="texy" class="form-control small-input" [disabled]="true" required #retailSeniorityRelation="ngModel" [(ngModel)]="retail.seniorityRelation" name="seniorityRelation" id="seniorityRelation">
                                <!--input type="text" class="form-control small-input"  required #retailEmploiStatus="ngModel" [(ngModel)]="retail.employementStatus" name="employementStatus" id="employementStatus"-->
                            </div>
                            
                        </div>
                    </div>
                    <div class="border p-3 rounded mb-4" *ngIf="retail.employementStatus =='CDD' ||retail.employementStatus =='CDI'  "> 
                        <h6 class="custom-label mb-3">Employeur / Contrepartie </h6>
                        <hr class="mb-3">
                        <div class="form-row mb-3 d-flex align-items-end">
                            <div class="form-group me-3">
                                <label for="retailEmployerSize" class="form-label small-label">Taille de l'employeur</label>
                                <select id="employerSizeSelect" #retailEmployerSize="ngModel"  
                                [(ngModel)]="retail.employerSize" name="retailEmployerSize" 
                                class="form-select small-select" required>
                                    <option [value]="'Grande Entreprise'">GE</option>
                                    <option [value]="'PME'">PME</option>
                                    <option [value]="'TPE'">TPE</option>
                                </select>
                                <!--input type="text" class="form-control small-input"  required #retailFinancingType="ngModel" [(ngModel)]="retail.financingType.description" name="financingTypeId" id="financingTypeId"-->
                            </div>
                            <div class="form-group me-3">
                                <label for="retailActivitySector" class="form-label small-label">Secteur d'activité </label>
                                <select id="activitySectorSelect" #corpoActivitySector="ngModel"  
                                [(ngModel)]="retail.activitySector.code" name="retailActivitySector" 
                                class="form-select small-select" required
                                (ngModelChange)="onActivitySectorChange($event)">
                                    <option *ngFor="let activite of activities" [value]="activite.code">{{ activite.description}}</option>
                                </select>                            
                            </div>
                        </div>
                        <div class="form-row mb-3 d-flex align-items-end">
                            
                            <div class="form-group me-3">
                                <label for="retailEmployementEntryDate" class="form-label small-label">Date Création</label>
                                <input type="date" class="form-control small-input" required #retailEmployementEntryDate="ngModel" 
                                [(ngModel)]="retail.employementEntryDate" name="employementEntryDate" id="employementEntryDate"
                                (ngModelChange)="onEmployementEntryDateChange($event)">
                            </div>
                            <div class="form-group me-3">
                                <label for="retailNbYearExperience" class="form-label small-label">Ancienneté de l'employeur</label>
                                <input type="texy" class="form-control small-input" [disabled]="true" required #retailNbYearExperience="ngModel" [(ngModel)]="retail.nbYearExperience" name="nbYearExperience" id="nbYearExperience">
                                <!--input type="text" class="form-control small-input"  required #retailEmploiStatus="ngModel" [(ngModel)]="retail.employementStatus" name="employementStatus" id="employementStatus"-->
                            </div>
                            
                        </div>
                        
                        <!-- Ligne séparatrice avec marge en bas -->
                    </div>
                    <div class="border p-3 rounded mb-4"> 
                        <h6 class="custom-label mb-3">Données Engagement</h6>
                        <hr class="mb-3">
                        <div class="form-row mb-3 d-flex align-items-end">
                            <div class="form-group me-3">
                                <label for="retailFinancingType" class="form-label small-label">Type de Financement</label>
                                <select id="financingTypeSelect" #retailFinancingType="ngModel"  [(ngModel)]="retail.financingType.financingTypeCode" name="retailFinancingType" class="form-select small-select" required>
                                    <option *ngFor="let type of financingTypes" [value]="type.financingTypeCode">{{ type.financingTypeCode}}</option>
                                </select>
                                <!--input type="text" class="form-control small-input"  required #retailFinancingType="ngModel" [(ngModel)]="retail.financingType.description" name="financingTypeId" id="financingTypeId"-->
                            </div>
                        </div>
                        <div class="form-row mb-3 d-flex align-items-end">
                            <div class="form-group me-3">
                                <label for="retailStartDate" class="form-label small-label">Date début</label>
                                <input type="date" class="form-control small-input" required #retailStartDate="ngModel" [(ngModel)]="retail.startDate" name="startDate" id="startDate">
                            </div>
                            <div class="form-group me-3">
                                <label for="retailEndDate" class="form-label small-label">Date Fin</label>
                                <input type="date" class="form-control small-input" required #retailEndDate="ngModel" [(ngModel)]="retail.endDate" name="endDate" id="endDate">
                            </div>
                        </div>
                        
                        <!-- Ligne séparatrice avec marge en bas -->
                    </div>
                    <div class="border p-3 rounded mb-4"> 
                        <h6 class="custom-label mb-3">Comportement client </h6>
                        <hr class="mb-3">
                        <div class="form-row mb-3 d-flex align-items-end">
                            <div class="form-group me-3">
                                <label for="retailEcheance" class="form-label small-label">Echeance</label>
                                <input type="text" class="form-control small-input" required #retailEcheance="ngModel" 
                                [(ngModel)]="retail.echeance" name="echeance" id="echeance"
                                (ngModelChange)="onEcheanceChange($event)">
                            </div>
                            <div class="form-group me-3">
                                <label for="retailTauxEndettement" class="form-label small-label">Taux d'endettement</label>
                                <input type="text" class="form-control small-input"  required #retailTauxEndettement="ngModel" 
                                [(ngModel)]="retail.deptRatio" name="deptRatio" id="deptRatio"
                                [disabled]="true">
                            </div>
                            
                        </div>
                        <div class="form-row mb-3 d-flex align-items-end">
                            <div class="form-group me-3">
                                <label for="retailUnpaiedPresence" class="form-label small-label">Comportement client (Banque & Secteur) Presence d'impayé </label>
                                <select id="retailUnpaiedPresence" #retailImpaye="ngModel"  
                                [(ngModel)]="retail.unpaidPresence" name="retailUnpaiedPresence" 
                                class="form-select small-select" required>
                                <option [value]="'Aucun impayé'">Aucun impayé et IMP Secteur (Non)</option>
                                <option [value]="'impayé inf 2 mois'">Impayés Inf à deux mois (< 2 Mois)</option>
                                <option [value]="'impayé sup 2 mois'">2 Mois < Impayés <= 3 Mois</option>
                                <option [value]="'impayé sup 3 mois'">Impayés Sup à 3 Mois et IMP Secteur (oui)</option>
                            </select>
                                
                                <!--input type="text" class="form-control small-input"  required #retailFinancingType="ngModel" [(ngModel)]="retail.financingType.description" name="financingTypeId" id="financingTypeId"-->
                            </div>
                            <div class="form-group me-3">
                                <label for="retailPayementIncident" class="form-label small-label">Incidents de paiement </label>
                                <select id="retailPayementIncident" #retailPayementIncident="ngModel"  
                                [(ngModel)]="retail.payementIncident" name="retailPayementIncident" 
                                class="form-select small-select" required>
                                <option [value]="'Aucun incident'">Aucun incident</option>
                                <option [value]="'incident de paiement sur cheque'">Incidents de paiement sur chéque durant les 3 derniers mois</option>
    
                                </select>
                                
                            </div>
                        </div>
                        <!-- Ligne séparatrice avec marge en bas -->
                    </div>
                    <div class="border p-3 rounded mb-4" *ngIf="retail.clientNotation !=null"> 
                        <h6 class="custom-label mb-3">Score Client</h6>
                        <hr class="mb-3">
                        <div class="form-row mb-3 d-flex align-items-end">
                            
                            <div class="form-group me-3">
                                <label for="finalScore" class="form-label small-label">Score Final</label>
                                <input type="text" class="form-control small-input" [disabled]="true" required #finalScore="ngModel" [(ngModel)]="retail.clientNotation.finalScore" name="finalScore" id="finalScore">
                            </div>
                            <div class="form-group me-3">
                                <label for="pd" class="form-label small-label">PD</label>
                                <input type="text" class="form-control small-input" [disabled]="true" required #pd="ngModel" [(ngModel)]="retail.clientNotation.pd" name="pd" id="pd">
                            </div>
                        </div>
                        <div class="form-row mb-3 d-flex align-items-end">
                            <div class="form-group me-3">
                                <label for="retailNote" class="form-label small-label">Niveau</label>
                                <input type="text" class="form-control small-input" [disabled]="true" required #retailNote="ngModel" [(ngModel)]="retail.clientNotation.decisionOctroi" name="clientNotation" id="clientNotation">
                            </div>
                            <div class="form-group me-3">
                                <label for="classe" class="form-label small-label">Classe</label>
                                <input type="text" class="form-control small-input" [disabled]="true" required #classe="ngModel" [(ngModel)]="retail.clientNotation.classe" name="classe" id="classe">
                            </div>
                        </div> <!-- Ligne séparatrice avec marge en bas -->
                    </div>
                    <!-- Uncomment to add a submit button -->
                    <!-- <button class="btn btn-success" [disabled]="!editSegmentForm.form.valid" type="submit">Submit</button> -->
                    <div class="modal-footer">
                        <button class="btn btn-custom-success btn-small"  [disabled]="!retailEditForm.form.valid" type="submit">Submit</button>
                        <button type="button" class="btn btn-custom-danger btn-small" data-bs-dismiss="modal">Annuler</button>
                    </div>
                
                </form>

            </div>
        </div>
    </div>
</div>


<!-- Modal pour creer un nouveau client   -->
<div class="modal fade" id="retailModal" tabindex="-1" aria-labelledby="retailModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h6 class="modal-title" id="retailModalLabel">Créer un nouveau client</h6>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="retailForm" (ngSubmit)="onSubmit()" #retailForm="ngForm">
                    <div class="border p-3 rounded mb-4"> 
                        <h6 class="custom-label mb-3">Données Agence</h6>
                        <hr class="mb-3">
                        <div class="form-row mb-3 d-flex align-items-end">
                            <div class="form-group me-3">
                                <label for="retailCodeAgence" class="form-label small-label">Code Agence</label>
                                <select id="retailBranchCode" #retailBranchCode="ngModel" [(ngModel)]="retail.branch.id" 
                                        name="retailBranchCode" class="form-select small-select" required
                                        (ngModelChange)="onBranchCodeChange($event)">
                                <option *ngFor="let option of branchs" [value]="option.id">{{ option.branchCode }}</option>
                                </select>
                            </div>
                            <div class="form-group me-3">
                                <label for="retailNomAgence" class="form-label small-label">Nom Agence</label>
                                <input 
                                type="text" class="form-control small-input" [disabled]="true" required 
                                [(ngModel)]="retail.branch.description"
                                name="branchName" id="retailNomAgence">
                            </div>
                        </div>
                    </div>
                                        
                    <div class="border p-3 rounded mb-4"> 
                        <h6 class="custom-label mb-3">Données Demande</h6>
                        <hr class="mb-3">
                        <div class="form-row mb-3 d-flex align-items-end">
                            <div class="form-group me-3">
                                <label for="retailAnnee" class="form-label small-label">Année</label>
                                <input type="text" class="form-control small-input" [disabled]="true" required #retailAnnee="ngModel" [(ngModel)]="retail.year" name="year" id="year">
                            </div>
                        </div> <!-- Ligne séparatrice avec marge en bas -->
                        <div class="form-row mb-3 d-flex align-items-end">
                            <div class="form-group me-3">
                                <label for="retailClientIdentifier" class="form-label small-label">Identifiant Client</label>
                                <input type="text" class="form-control small-input" [disabled]="false" required #retailClientIdentifier="ngModel" [(ngModel)]="retail.clientRequest" name="clientRequest" id="clientRequest">
                            </div>
                            <div class="form-group me-3" *ngIf="retail.contractReference !=null && retail.contractReference!=''">
                                <label for="retailRequestRef" class="form-label small-label">Référence demande</label>
                                <input type="text" class="form-control small-input" [disabled]="true" required #retailRequestRef="ngModel" [(ngModel)]="retail.contractReference" name="contractReference" id="contractReference">
                            </div>
                        </div>

                    </div>
                    
                    <div class="border p-3 rounded mb-4"> 
                        <h4 class="custom-label mb-3">Données client</h4>
                        <hr class="mb-3"> <!-- Ligne séparatrice avec marge en bas -->
                        <div class="form-row mb-3 d-flex align-items-end">
                            <div class="form-group me-3">
                                <label for="retailCivilite" class="form-label small-label">Civilité</label>
                                <select class="form-control small-input" required [(ngModel)]="retail.civility" name="civility" id="civility"
                                (ngModelChange)="onCivilityChange($event)">
                                    <option *ngFor="let option of civilityOptions" [value]="option">{{ option }}</option>
                                </select>
                                <!--input type="text" class="form-control small-input"  required #retailCivilite="ngModel" [(ngModel)]="retail.civility" name="civility" id="civility"-->
                            </div>
                            <div class="form-group me-3">
                                <label for="retailSexe" class="form-label small-label">Sexe</label>
                                <select class="form-control small-input" required [(ngModel)]="retail.gender" name="gender" id="gender" [disabled]="true">
                                    <option *ngFor="let option of genderOptions" [disabled]="true" [value]="option">{{ option }}</option>
                                </select>
                                <!--input type="text" class="form-control small-input"  required #retailSexe="ngModel" [(ngModel)]="retail.gender" name="gender" id="gender"-->
                            </div>
                            <div class="form-group me-3">
                                <label for="retailFamilySituation" class="form-label small-label">Situation de Famille</label>
                                <select class="form-control small-input" required [(ngModel)]="retail.familySituation" name="familySituation" id="familySituation">
                                    <option *ngFor="let situation  of familySituationOptions" [value]="situation ">{{ familySituationDisplay[situation] }}</option>
                                </select>
                                <!--input type="text" class="form-control small-input"  required #retailFamilySituation="ngModel" [(ngModel)]="retail.familySituation" name="familySituation" id="familySituation"-->
                            </div>
                        </div>
                        <div class="form-row mb-3 d-flex align-items-end">
                            <div class="form-group me-3">
                                <label for="retailFirstName" class="form-label small-label">Prenom</label>
                                <input type="text" class="form-control small-input" required #retailFirstName="ngModel" [(ngModel)]="retail.firstName" name="firstName" id="firstName">
                            </div>
                            <div class="form-group me-3">
                                <label for="retailLastName" class="form-label small-label">Nom</label>
                                <input type="text" class="form-control small-input" required #retailLastName="ngModel" [(ngModel)]="retail.lastName" name="lastName" id="lastName">
                            </div>

                        </div>
                        <div class="form-row mb-3 d-flex align-items-end">
                            <div class="form-group me-3">
                                <label for="retailBirthDate" class="form-label small-label">Date Naissance</label>
                                <input type="date" class="form-control small-input"  required 
                                #retailBirthDate="ngModel" [(ngModel)]="retail.birthDate" 
                                name="birthDate" id="birthDate"
                                (ngModelChange)="onBirthDateChange($event)"  >
                            </div>
                            <div class="form-group me-3">
                                <label for="retailAge" class="form-label small-label">Age</label>
                                <input type="text" class="form-control small-input" [disabled]="true" required #retailAge="ngModel" 
                                [(ngModel)]="retail.age" name="age" id="age">
                            </div>
                        </div>
                        <div class="form-row mb-3 d-flex align-items-end">
                            <div class="form-group me-3">
                                <label for="retailEmail" class="form-label small-label">Email</label>
                                <input type="email" class="form-control small-input"
                                required 
                                #retailEmail="ngModel" 
                                [(ngModel)]="retail.email" 
                                name="email" 
                                id="email"
                                pattern="^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$" 
                                [ngClass]="{'is-invalid': retailEmail.invalid && (retailEmail.touched || retailEmail.dirty)}" 
                                placeholder="exemple@domaine.com">
                                <div  *ngIf="retailEmail.invalid && retailEmail.touched" class="alert alert-danger">
                                    Veuillez entrer une adresse email valide.
                                </div>
                            </div>
                            <div class="form-group me-3">
                                <label for="retailTel" class="form-label small-label">Téléphone</label>
                                <input type="text" class="form-control small-input" 
                                    required 
                                    #retailTel="ngModel" 
                                    [(ngModel)]="retail.telephone" 
                                    name="telephone" id="telephone"
                                    maxlength="8" 
                                    pattern="^[0-9]{8}$"
                                    [ngClass]="{'is-invalid': retailTel.invalid && retailTel.touched}" 
                                    placeholder="8 chiffres max.">
                                <div *ngIf="retailTel.invalid && retailTel.touched" class="alert alert-danger">
                                    Le numéro de téléphone doit contenir uniquement des chiffres et être au maximum de 8 caractères.
                                </div>
                            </div>
                        </div>
                        <div class="form-row mb-3 d-flex align-items-end">
                            <div class="form-group me-3">
                                
                                <div  *ngIf=" retailEmail.invalid && retailEmail.touched" class="alert alert-danger">
                                    Veuillez entrer une adresse email valide.
                                </div>
                            </div>
                            <div class="form-group me-3">
                                
                                <div *ngIf="  retailTel.invalid && retailTel.touched" class="alert alert-danger">
                                    Le numéro de téléphone doit contenir uniquement des chiffres et être au maximum de 8 caractères.
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="border p-3 rounded mb-4"> 
                        <h4 class="custom-label mb-3">Données Financement</h4>
                        <hr class="mb-3"> <!-- Ligne séparatrice avec marge en bas -->
                                                
                        <div class="form-row mb-3 d-flex align-items-end">
                            <div class="form-group me-3">
                                <label for="retailProfession" class="form-label small-label">Profession</label>
                                <input type="text" class="form-control small-input"  required #retailProfession="ngModel" [(ngModel)]="retail.profession" name="profession" id="profession">
                            </div>
                            <div class="form-group me-3">
                                <label for="retailEmploiStatus" class="form-label small-label">Statut Emplois</label>
                                <select class="form-control small-input" required [(ngModel)]="retail.employementStatus" name="employementStatus" id="employementStatus">
                                    <option *ngFor="let option of emploiStatusOptions" [value]="option">{{ option }}</option>
                                </select>
                                <!--input type="text" class="form-control small-input"  required #retailEmploiStatus="ngModel" [(ngModel)]="retail.employementStatus" name="employementStatus" id="employementStatus"-->
                            </div>
                            
                        </div>
                        <div class="form-row mb-3 d-flex align-items-end">
                            <div class="form-group me-3">
                                <label for="retailRevenu" class="form-label small-label">Revenues Client</label>
                                <input type="text" class="form-control small-input"  required #retailRevenu="ngModel" 
                                [(ngModel)]="retail.revenu" name="revenu" id="revenu"
                                (ngModelChange)="onRevenueChange($event)">
                            </div>
                            <div class="form-group me-3">
                                <label for="retailNbrDependents" class="form-label small-label">Nombre des personnes a charge</label>
                                <input type="text" class="form-control small-input"  required #retailNbrDependents="ngModel" [(ngModel)]="retail.nbrDependents" name="nbrDependents" id="nbrDependents">
                            </div>
                        </div>
                        <div class="form-row mb-3 d-flex align-items-end">
                            
                            <div class="form-group me-3">
                                <label for="retailRelationEntryDate" class="form-label small-label">Date d'entrée en relation avec la Banque </label>
                                <input type="date" class="form-control small-input" required #retailRelationEntryDate="ngModel" 
                                [(ngModel)]="retail.relationEntryDate" name="relationEntryDate" id="relationEntryDate"
                                (ngModelChange)="onRelationEntryDateChange($event)">
                            </div>
                            <div class="form-group me-3">
                                <label for="retailSeniorityRelation" class="form-label small-label">Ancienneté relation avec la banque</label>
                                <input type="texy" class="form-control small-input" [disabled]="true" required #retailSeniorityRelation="ngModel" [(ngModel)]="retail.seniorityRelation" name="seniorityRelation" id="seniorityRelation">
                                <!--input type="text" class="form-control small-input"  required #retailEmploiStatus="ngModel" [(ngModel)]="retail.employementStatus" name="employementStatus" id="employementStatus"-->
                            </div>
                            
                        </div>
                    </div>
                    <div class="border p-3 rounded mb-4" *ngIf="retail.employementStatus =='CDD' ||retail.employementStatus =='CDI'  "> 
                        <h6 class="custom-label mb-3">Employeur / Contrepartie </h6>
                        <hr class="mb-3">
                        <div class="form-row mb-3 d-flex align-items-end">
                            <div class="form-group me-3">
                                <label for="retailEmployerSize" class="form-label small-label">Taille de l'employeur</label>
                                <select id="employerSizeSelect" #retailEmployerSize="ngModel"  
                                [(ngModel)]="retail.employerSize" name="retailEmployerSize" 
                                class="form-select small-select" required>
                                    <option [value]="'Grande Entreprise'">GE</option>
                                    <option [value]="'PME'">PME</option>
                                    <option [value]="'PME'">TPE</option>
                                </select>
                                <!--input type="text" class="form-control small-input"  required #retailFinancingType="ngModel" [(ngModel)]="retail.financingType.description" name="financingTypeId" id="financingTypeId"-->
                            </div>
                            <div class="form-group me-3">
                                <label for="retailActivitySector" class="form-label small-label">Secteur d'activité </label>
                                <select id="activitySectorSelect" #corpoActivitySector="ngModel"  
                                [(ngModel)]="retail.activitySector.code" name="retailActivitySector" 
                                class="form-select small-select" required
                                (ngModelChange)="onActivitySectorChange($event)">
                                    <option *ngFor="let activite of activities" [value]="activite.code">{{ activite.description}}</option>
                                </select>                            
                            </div>
                        </div>
                        <div class="form-row mb-3 d-flex align-items-end">
                            
                            <div class="form-group me-3">
                                <label for="retailEmployementEntryDate" class="form-label small-label">Date Création</label>
                                <input type="date" class="form-control small-input" required #retailEmployementEntryDate="ngModel" 
                                [(ngModel)]="retail.employementEntryDate" name="employementEntryDate" id="employementEntryDate"
                                (ngModelChange)="onEmployementEntryDateChange($event)">
                            </div>
                            <div class="form-group me-3">
                                <label for="retailNbYearExperience" class="form-label small-label">Ancienneté de l'employeur</label>
                                <input type="texy" class="form-control small-input" [disabled]="true" required #retailNbYearExperience="ngModel" [(ngModel)]="retail.nbYearExperience" name="nbYearExperience" id="nbYearExperience">
                                <!--input type="text" class="form-control small-input"  required #retailEmploiStatus="ngModel" [(ngModel)]="retail.employementStatus" name="employementStatus" id="employementStatus"-->
                            </div>
                            
                        </div>
                        
                        <!-- Ligne séparatrice avec marge en bas -->
                    </div>
                    <div class="border p-3 rounded mb-4"> 
                        <h6 class="custom-label mb-3">Données Engagement</h6>
                        <hr class="mb-3">
                        <div class="form-row mb-3 d-flex align-items-end">
                            <div class="form-group me-3">
                                <label for="retailFinancingType" class="form-label small-label">Type de Financement</label>
                                <select id="financingTypeSelect" #retailFinancingType="ngModel"  
                                [(ngModel)]="retail.financingType.financingTypeCode" name="retailFinancingType" 
                                class="form-select small-select" required
                                (ngModelChange)="onFinancingTypeChange($event)">
                                    <option *ngFor="let type of financingTypes" [value]="type.financingTypeCode">{{ type.financingTypeCode}}</option>
                                </select>
                                <!--input type="text" class="form-control small-input"  required #retailFinancingType="ngModel" [(ngModel)]="retail.financingType.description" name="financingTypeId" id="financingTypeId"-->
                            </div>
                        </div>
                        <div class="form-row mb-3 d-flex align-items-end">
                            <div class="form-group me-3">
                                <label for="retailStartDate" class="form-label small-label">Date début</label>
                                <input type="date" class="form-control small-input" required #retailStartDate="ngModel" [(ngModel)]="retail.startDate" name="startDate" id="startDate">
                            </div>
                            <div class="form-group me-3">
                                <label for="retailEndDate" class="form-label small-label">Date Fin</label>
                                <input type="date" class="form-control small-input" required #retailEndDate="ngModel" [(ngModel)]="retail.endDate" name="endDate" id="endDate">
                            </div>
                        </div>
                        <!--div class="form-row mb-3 d-flex align-items-end">
                            <div class="form-group me-3">
                                <label for="retailCapitalNominal" class="form-label small-label">Capital Nominal</label>
                                <input type="text" class="form-control small-input" required #retailCapitalNominal="ngModel" [(ngModel)]="retail.capitalNominal" name="capitalNominal" id="capitalNominal">
                            </div>
                            <div class="form-group me-3">
                                <label for="retailCapitalImpaye" class="form-label small-label">Capital Impayé</label>
                                <input type="text" class="form-control small-input"  required #retailCapitalImpaye="ngModel" [(ngModel)]="retail.capitalImpaye" name="capitalImpaye" id="capitalImpaye">
                            </div>
                        </!--div-->
                        <!-- Ligne séparatrice avec marge en bas -->
                    </div>
                    
                    <div class="border p-3 rounded mb-4"> 
                        <h6 class="custom-label mb-3">Comportement client </h6>
                        <hr class="mb-3">
                        <div class="form-row mb-3 d-flex align-items-end">
                            <div class="form-group me-3">
                                <label for="retailEcheance" class="form-label small-label">Echeance</label>
                                <input type="text" class="form-control small-input" required #retailEcheance="ngModel" 
                                [(ngModel)]="retail.echeance" name="echeance" id="echeance"
                                (ngModelChange)="onEcheanceChange($event)">
                            </div>
                            <div class="form-group me-3">
                                <label for="retailTauxEndettement" class="form-label small-label">Taux d'endettement</label>
                                <input type="text" class="form-control small-input"  required #retailTauxEndettement="ngModel" 
                                [(ngModel)]="retail.deptRatio" name="deptRatio" id="deptRatio"
                                [disabled]="true">
                            </div>
                            
                        </div>
                        <div class="form-row mb-3 d-flex align-items-end">
                            <div class="form-group me-3">
                                <label for="retailUnpaiedPresence" class="form-label small-label">Comportement client (Banque & Secteur) Presence d'impayé </label>
                                <select id="retailUnpaiedPresence" #retailImpaye="ngModel"  
                                [(ngModel)]="retail.unpaidPresence" name="retailUnpaiedPresence" 
                                class="form-select small-select" required>
                                <option [value]="'Aucun impayé'">Aucun impayé et IMP Secteur (Non)</option>
                                <option [value]="'impayé inf 2 mois'">Impayés Inf à deux mois (< 2 Mois)</option>
                                <option [value]="'impayé sup 2 mois'">2 Mois < Impayés <= 3 Mois</option>
                                <option [value]="'impayé sup 3 mois'">Impayés Sup à 3 Mois et IMP Secteur (oui)</option>
                                </select>
                                
                                <!--input type="text" class="form-control small-input"  required #retailFinancingType="ngModel" [(ngModel)]="retail.financingType.description" name="financingTypeId" id="financingTypeId"-->
                            </div>
                            <div class="form-group me-3">
                                <label for="retailPayementIncident" class="form-label small-label">Incidents de paiement </label>
                                <select id="retailPayementIncident" #retailPayementIncident="ngModel"  
                                [(ngModel)]="retail.payementIncident" name="retailPayementIncident" 
                                class="form-select small-select" required>
                                <option [value]="'Aucun incident'">Aucun incident</option>
                                <option [value]="'incident de paiement sur cheque'">Incidents de paiement sur chéque durant les 3 derniers mois</option>
    
                                </select>
                                
                            </div>
                        </div>
                        <!-- Ligne séparatrice avec marge en bas -->
                    </div>
                    
                    <!-- Uncomment to add a submit button -->
                    <!-- <button class="btn btn-success" [disabled]="!editSegmentForm.form.valid" type="submit">Submit</button> -->
                    <div class="modal-footer">
                        <button class="btn btn-custom-success btn-small"  [disabled]="!retailForm.form.valid" type="submit">Submit</button>
                        <button type="button" class="btn btn-custom-danger btn-small" data-bs-dismiss="modal">Annuler</button>
                    </div>
                
                </form>

            </div>
        </div>
    </div>
</div>




<!-- Modal de confirmation de suppression -->
<div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-labelledby="confirmDeleteModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h6 class="modal-title" id="confirmDeleteModalLabel">Confirmer la suppression</h6>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" style="font-size: 13px;">
                Êtes-vous sûr de vouloir supprimer ce Client ?
            </div>
            <div class="modal-footer">
                <button type="button btn-small " class="btn btn-outline-secondary btn-small" (click)="confirmDelete()">Supprimer</button>
                <button type="button btn-small" class="btn btn-outline-secondary btn-small" data-bs-dismiss="modal">Annuler</button>
            </div>
        </div>
    </div>
</div>