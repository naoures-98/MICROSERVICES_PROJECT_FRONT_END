<div class="container mt-5">
    <h2>Gestion des Utilisateurs</h2>
    <div class="container mt-5">
        <button type="button" class="btn btn-custom-secondary me-2 mb-3" data-bs-toggle="modal" data-bs-target="#userModal">
            Ajouter un nouveau utilisateur
        </button>
        <button type="button" class="btn btn-custom-secondary me-2 mb-3" data-bs-toggle="modal" data-bs-target="#userImportExcelModal">
            Import EXCEL
        </button>
        <input type="text" [(ngModel)]="searchText" class="form-control mb-3" placeholder="Rechercher...">
    </div>
    <table class="table table-bordered">
        <thead>
            <tr>
                <th>#</th>
                <th>UserName</th>
                <th>Password</th>
                <th>DATE CREATION</th>
                <th class="text-center">ACTIONS</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let jForm of filteredUsers | paginate: { itemsPerPage: itemsPerPage, currentPage: p }">
                <td>test</td>
                <td>test</td>
                <td>test</td>
                <td>test</td>
                <td class="text-center">
                    <button type="button" class="btn btn-custom-warning me-2" data-bs-toggle="modal" (click)="editUser(user)" data-bs-target="#userEditModal">
                        Edit
                    </button>
                    <button class="btn btn-custom-danger" (click)="openDeleteModal(user.id)" data-bs-toggle="modal" data-bs-target="#confirmDeleteModal">Delete</button>
                </td>
            </tr>
        </tbody>
    </table>
    <pagination-controls (pageChange)="p = $event"></pagination-controls>
</div>
<!-- Modal pour ajouter une nouvelle JfORM -->
<div class="modal fade" id="userModal" tabindex="-1" aria-labelledby="userModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="userModalLabel">Créer un nouveau Utilisateur</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form  [formGroup]="registerForm" (ngSubmit)=submitForm() >
                    <div class="form-group mb-3">
                        <label for="userCode" class="form-label">UserName</label>
                        <input type="text" class="form-control" required  name="userCode" id="userCode" formControlName="userCode">
                    </div>
                    <div class="form-group mb-3">
                        <label for="userPassword" class="form-label">Mot de Passe</label>
                        <input type="password" class="form-control" required   name="userPassword" id="userPassword" formControlName="password">
                    </div>
                    <div class="form-group mb-3">
                        <label for="userPassword" class="form-label">Confirmer Mot de Passe</label>
                        <input type="password" class="form-control" required   name="confirmPassword" id="confirmPassword" formControlName="confirmPassword">
                    </div>

                    <button class="btn btn-custom-success" [disabled]="registerForm.invalid"  type="submit">Submit</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Modal pour modifier un utilisateur  -->
<div class="modal fade" id="userEditModal" tabindex="-1" aria-labelledby="userEditModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="userEditModalLabel">Modifier Utilisateur</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="userEditForm" (ngSubmit)="onEditSubmit()" #editUserForm="ngForm">

                    <div class="form-group mb-3">
                        <label for="editCodeUser" class="form-label">UserName</label>
                        <input type="text" class="form-control"   [disabled]="true" required #editCodeUser="ngModel" [(ngModel)]="user.userCode" name="editCodeUser" id="editCodeUser">
                    </div>
                    <div *ngIf="editCodeUser.touched && editCodeUser.invalid" class="alert alert-danger">UserName est obligatoire !</div>
                    <div class="form-group mb-3">
                        <label for="editPassword" class="form-label">Mot de Passe</label>
                        <input type="text" class="form-control" required #editPassword="ngModel" [(ngModel)]="user.password" name="editPassword" id="editPassword">
                    </div>
                    <div *ngIf="editPassword.touched && editPassword.invalid" class="alert alert-danger">Mot de Passe est obligatoire !</div>
                    <button class="btn btn-custom-success" [disabled]="!editUserForm.form.valid" type="submit">Submit</button>
                </form>
            </div>
        </div>
    </div>
</div>
<!-- Modal de confirmation de suppression -->
<div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-labelledby="confirmDeleteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="confirmDeleteModalLabel">Confirmer la suppression</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Êtes-vous sûr de vouloir supprimer cet Utilisateur ?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Annuler</button>
                <button type="button" class="btn btn-outline-danger" (click)="confirmDelete()">Supprimer</button>
            </div>
        </div>
    </div>
</div>